const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/submit-claim-modal-DxL7_nOZ.js","assets/ui-vendor-BwlLg9O9.js","assets/react-vendor-BV8CqAlW.js","assets/card-B87lmAsb.js","assets/index-DvB6HgzU.js","assets/utils-vendor-BEyFXcp4.js","assets/index-BBd95vzR.css","assets/input-CqLO7V2k.js","assets/label-_J7CDay_.js","assets/currency-DQnJccph.js"])))=>i.map(i=>d[i]);
import{D as ne,c as oe,B as Z,d as ce,e as de,f as ue,a as v,u as me,_ as he}from"./index-DvB6HgzU.js";import{j as e}from"./ui-vendor-BwlLg9O9.js";import{T as xe,a as pe,b as je,c as _}from"./tabs-CT2nD0Ou.js";import{C as P,a as R,b as T,d as M}from"./card-B87lmAsb.js";import{I as fe}from"./input-CqLO7V2k.js";import{T as L,a as k,b as j,c as o,d as V,e as l}from"./table-xhyeBtUg.js";import{B as ve}from"./badge-BSpsjrqz.js";import{S as ge}from"./separator-BoX4pgoZ.js";import{r as i}from"./react-vendor-BV8CqAlW.js";import{f as $}from"./currency-DQnJccph.js";import{E as be,p as Ne,q as ye,X as Ce,g as Ee,r as Ie}from"./utils-vendor-BEyFXcp4.js";const f=(t,g="info")=>{const x=document.createElement("div");x.className=`fixed top-4 right-4 z-50 p-4 rounded-md text-white ${g==="success"?"bg-green-600":g==="error"?"bg-red-600":"bg-blue-600"}`,x.textContent=t,document.body.appendChild(x),setTimeout(()=>{document.body.contains(x)&&document.body.removeChild(x)},3e3)};function Se({claim:t,userRole:g,userId:x,onClaimUpdate:N}){const[C,p]=i.useState(!1),E=()=>g==="ADMIN"||g==="PROVIDER"&&t.provider===x,y=()=>{const a=[];if(a.push({key:"view",label:"View Details",icon:Ne,action:()=>I()}),!E())return a;const n=t.status;return["PENDING","INVESTIGATING","REQUIRES_PREAUTH"].includes(n)&&a.push({key:"approve",label:"Approve Claim",icon:ye,variant:"success",action:()=>S()}),["PENDING","INVESTIGATING","REQUIRES_PREAUTH"].includes(n)&&a.push({key:"reject",label:"Reject Claim",icon:Ce,variant:"destructive",action:()=>A()}),["PENDING","REQUIRES_PREAUTH"].includes(n)&&a.push({key:"investigate",label:"Mark for Investigation",icon:Ee,variant:"warning",action:()=>D()}),g==="ADMIN"&&n==="REJECTED"&&a.push({key:"reprocess",label:"Re-process Claim",icon:Ie,action:()=>w()}),a},I=()=>{f(`View claim #${t.id} details`,"info")},S=async()=>{var a,n,d,u;if(confirm(`Are you sure you want to approve claim #${t.id}?`)){p(!0);try{const b=await v.post(`/api/claims/${t.id}/approve/`);f(b.detail||"Claim approved successfully","success"),N(b.claim)}catch(c){const b=((n=(a=c.response)==null?void 0:a.data)==null?void 0:n.detail)||c.message||"Failed to approve claim";f(b,"error"),(u=(d=c.response)==null?void 0:d.data)!=null&&u.reason&&f(`Reason: ${c.response.data.reason}`,"error")}finally{p(!1)}}},A=async()=>{var n,d;const a=prompt(`Please provide a reason for rejecting claim #${t.id}:`);if(!a||a.trim()===""){f("Rejection reason is required","error");return}p(!0);try{const c=await v.post(`/api/claims/${t.id}/reject/`,{reason:a.trim()});f(c.detail||"Claim rejected successfully","success"),N(c.claim)}catch(u){const c=((d=(n=u.response)==null?void 0:n.data)==null?void 0:d.detail)||u.message||"Failed to reject claim";f(c,"error")}finally{p(!1)}},D=async()=>{var n,d;const a=prompt(`Add investigation notes for claim #${t.id} (optional):`);p(!0);try{const c=await v.post(`/api/claims/${t.id}/investigate/`,{notes:(a==null?void 0:a.trim())||"Under investigation"});f(c.detail||"Claim marked for investigation","success"),N(c.claim)}catch(u){const c=((d=(n=u.response)==null?void 0:n.data)==null?void 0:d.detail)||u.message||"Failed to mark claim for investigation";f(c,"error")}finally{p(!1)}},w=async()=>{var a,n;if(confirm(`Are you sure you want to reprocess claim #${t.id}? This will reset it to PENDING status.`)){p(!0);try{const u=await v.patch(`/api/claims/${t.id}/`,{status:"PENDING",rejection_reason:"",rejection_date:null});f("Claim marked for reprocessing","success"),N(u)}catch(d){const u=((n=(a=d.response)==null?void 0:a.data)==null?void 0:n.detail)||d.message||"Failed to reprocess claim";f(u,"error")}finally{p(!1)}}},m=y();return m.length===0?null:e.jsxs(ne,{children:[e.jsx(oe,{asChild:!0,children:e.jsxs(Z,{variant:"ghost",className:"h-8 w-8 p-0",disabled:C,children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Open menu"})]})}),e.jsx(ce,{align:"end",className:"w-56",children:m.map((a,n)=>{const d=a.icon,u=a.variant==="destructive",c=a.variant==="success",b=a.variant==="warning";return e.jsxs(e.Fragment,{children:[e.jsxs(de,{onClick:a.action,disabled:C,className:u?"text-destructive focus:text-destructive":c?"text-green-600 focus:text-green-600":b?"text-yellow-600 focus:text-yellow-600":"",children:[e.jsx(d,{className:"mr-2 h-4 w-4"}),a.label]},a.key),n===0&&m.length>1&&e.jsx(ue,{},`separator-${n}`)]})})})]})}const Ae=i.lazy(()=>he(()=>import("./submit-claim-modal-DxL7_nOZ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])).then(t=>({default:t.SubmitClaimModal}))),De=()=>e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})});function He(){const{user:t}=me(),[g,x]=i.useState([]),[N,C]=i.useState(null),[p,E]=i.useState(null),[y,I]=i.useState("-date_submitted"),[S,A]=i.useState(!1),[D,w]=i.useState(null),[m,a]=i.useState({search:"",status:""}),[n,d]=i.useState(!1),[u,c]=i.useState(null),[b,O]=i.useState(!1),[we,G]=i.useState(null),[ee,se]=i.useState(null),[F,U]=i.useState(!1),[_e,H]=i.useState(null),[te,re]=i.useState(null),[q,B]=i.useState(!1),[Pe,Q]=i.useState(null),ae=()=>{const s=[{value:"claims",label:"Claims"}];return(t==null?void 0:t.role)==="ADMIN"?s.push({value:"providers",label:"Providers"},{value:"schemes",label:"Schemes"},{value:"members",label:"Members"}):(t==null?void 0:t.role)==="PROVIDER"&&s.push({value:"providers",label:"My Practice"}),s},ie=s=>{x(r=>r.map(h=>h.id===s.id?s:h))};i.useEffect(()=>{let s=!0;A(!0),w(null);const r=new URLSearchParams;return r.set("ordering",y),m.search&&r.set("search",m.search),m.status&&r.set("status",m.status),v.get(`/api/claims/?${r.toString()}`).then(h=>{s&&(x(h.results??h),C(h.next??null),E(h.previous??null))}).catch(h=>{s&&w(h.message||"Failed to load claims")}).finally(()=>{s&&A(!1)}),()=>{s=!1}},[y,m]),i.useEffect(()=>{if(!t||!["ADMIN","PROVIDER"].includes(t.role))return;let s=!0;return O(!0),G(null),v.get("/api/core/analytics/providers/").then(r=>{s&&c(r.results??r)}).catch(r=>{s&&G(r.message||"Failed to load providers")}).finally(()=>{s&&O(!1)}),()=>{s=!1}},[t]),i.useEffect(()=>{if(!t||t.role!=="ADMIN")return;let s=!0;return U(!0),H(null),v.get("/api/core/analytics/schemes/overview/").then(r=>{s&&se(r.results??r)}).catch(r=>{s&&H(r.message||"Failed to load schemes")}).finally(()=>{s&&U(!1)}),()=>{s=!1}},[t]),i.useEffect(()=>{if(!t||t.role!=="ADMIN")return;let s=!0;return B(!0),Q(null),v.get("/api/core/analytics/members/").then(r=>{s&&re(r.results??r)}).catch(r=>{s&&Q(r.message||"Failed to load members")}).finally(()=>{s&&B(!1)}),()=>{s=!1}},[t]);const z=i.useMemo(()=>{let s=g;if(m.search){const r=m.search.toLowerCase();s=s.filter(h=>{var J,W,X,K,Y;return`${h.id}`.includes(r)||((W=(J=h.patient_detail)==null?void 0:J.user_username)==null?void 0:W.toLowerCase().includes(r))||((K=(X=h.patient_detail)==null?void 0:X.member_id)==null?void 0:K.toLowerCase().includes(r))||((Y=h.service_type_name)==null?void 0:Y.toLowerCase().includes(r))})}return m.status&&(s=s.filter(r=>r.status===m.status)),s},[g,m]),le=ae();return t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Claims Management"}),e.jsxs("p",{className:"text-muted-foreground",children:[t.role==="PATIENT"&&"View and track your submitted claims",t.role==="PROVIDER"&&"Manage claims submitted to your practice",t.role==="ADMIN"&&"Comprehensive claims management and analytics"]})]}),(t.role==="PROVIDER"||t.role==="PATIENT")&&e.jsx(Z,{onClick:()=>d(!0),children:"Submit Claim"})]}),e.jsxs(xe,{defaultValue:"claims",className:"space-y-4",children:[e.jsx(pe,{children:le.map(s=>e.jsx(je,{value:s.value,children:s.label},s.value))}),e.jsx(_,{value:"claims",children:e.jsxs(P,{children:[e.jsx(R,{children:e.jsxs(T,{children:[t.role==="PATIENT"&&"My Claims",t.role==="PROVIDER"&&"Claims to Review",t.role==="ADMIN"&&"All Claims"]})}),e.jsxs(M,{className:"space-y-4",children:[D&&e.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded",children:D}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(fe,{placeholder:"Search claims...",value:m.search,onChange:s=>a(r=>({...r,search:s.target.value})),className:"max-w-sm"}),e.jsxs("select",{value:m.status,onChange:s=>a(r=>({...r,status:s.target.value})),className:"rounded border px-3 py-2",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"APPROVED",children:"Approved"}),e.jsx("option",{value:"REJECTED",children:"Rejected"}),e.jsx("option",{value:"INVESTIGATING",children:"Investigating"}),e.jsx("option",{value:"REQUIRES_PREAUTH",children:"Requires Pre-auth"})]})]}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(L,{children:[e.jsx(k,{children:e.jsxs(j,{children:[e.jsx(o,{children:e.jsx("button",{onClick:()=>I(y==="id"?"-id":"id"),children:"Claim ID"})}),e.jsx(o,{children:"Member"}),t.role==="ADMIN"&&e.jsx(o,{children:"Provider"}),e.jsx(o,{children:"Service"}),e.jsx(o,{children:e.jsx("button",{onClick:()=>I(y==="date_submitted"?"-date_submitted":"date_submitted"),children:"Date"})}),e.jsx(o,{className:"text-right",children:e.jsx("button",{onClick:()=>I(y==="cost"?"-cost":"cost"),children:"Amount"})}),e.jsx(o,{children:"Status"}),e.jsx(o,{})]})}),e.jsxs(V,{children:[S&&Array.from({length:8}).map((s,r)=>e.jsx(j,{children:e.jsx(l,{colSpan:t.role==="ADMIN"?8:7,className:"text-xs text-muted-foreground",children:"Loading…"})},r)),!S&&z.map(s=>{var r;return e.jsxs(j,{children:[e.jsxs(l,{children:["#",s.id]}),e.jsx(l,{children:(r=s.patient_detail)==null?void 0:r.user_username}),t.role==="ADMIN"&&e.jsx(l,{children:s.provider_username||`#${s.provider}`}),e.jsx(l,{children:s.service_type_name}),e.jsx(l,{children:new Date(s.date_submitted).toLocaleDateString()}),e.jsx(l,{className:"text-right",children:$(s.cost)}),e.jsx(l,{children:e.jsx(ve,{variant:s.status==="APPROVED"?"success":s.status==="PENDING"?"warning":"destructive",children:s.status.charAt(0)+s.status.slice(1).toLowerCase()})}),e.jsx(l,{children:e.jsx(Se,{claim:s,userRole:t.role,userId:t.id,onClaimUpdate:ie})})]},s.id)})]})]})}),e.jsx(ge,{className:"my-3"}),e.jsxs("div",{className:"mt-3 flex items-center justify-end gap-2 text-sm",children:[e.jsx("button",{className:"rounded border px-2 py-1 disabled:opacity-50",disabled:!p,onClick:()=>p&&v.get(p).then(s=>{x(s.results??s),C(s.next??null),E(s.previous??null)}),children:"Prev"}),e.jsx("button",{className:"rounded border px-2 py-1 disabled:opacity-50",disabled:!N,onClick:()=>N&&v.get(N).then(s=>{x(s.results??s),C(s.next??null),E(s.previous??null)}),children:"Next"})]}),!S&&z.length===0&&e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:[t.role==="PATIENT"&&"No claims found. ",t.role==="PROVIDER"&&"No claims to review. ",t.role==="ADMIN"&&"No claims match filters. ",(t.role==="PROVIDER"||t.role==="PATIENT")&&e.jsx("button",{className:"text-accent underline",onClick:()=>d(!0),children:"Submit Claim"})]})]})]})}),e.jsx(_,{value:"schemes",children:e.jsxs(P,{children:[e.jsx(R,{children:e.jsx(T,{className:"text-base",children:"Schemes"})}),e.jsx(M,{children:e.jsx("div",{className:"overflow-auto",children:e.jsxs(L,{children:[e.jsx(k,{children:e.jsxs(j,{children:[e.jsx(o,{children:"Scheme"}),e.jsx(o,{children:"Members"}),e.jsx(o,{children:"Claims (30d)"}),e.jsx(o,{className:"text-right",children:"Amount (30d)"})]})}),e.jsxs(V,{children:[F&&Array.from({length:6}).map((s,r)=>e.jsx(j,{children:e.jsx(l,{colSpan:4,className:"text-xs text-muted-foreground",children:"Loading…"})},r)),!F&&(ee??[]).map(s=>e.jsxs(j,{children:[e.jsx(l,{children:s.name}),e.jsx(l,{children:s.members_count}),e.jsx(l,{children:s.total_claims_30d}),e.jsx(l,{className:"text-right",children:$(s.total_amount_30d||0)})]},s.id))]})]})})})]})}),e.jsx(_,{value:"providers",children:e.jsxs(P,{children:[e.jsx(R,{children:e.jsx(T,{className:"text-base",children:"Providers"})}),e.jsx(M,{children:e.jsx("div",{className:"overflow-auto",children:e.jsxs(L,{children:[e.jsx(k,{children:e.jsxs(j,{children:[e.jsx(o,{children:"Provider"}),e.jsx(o,{children:"Claims"}),e.jsx(o,{children:"Approval %"}),e.jsx(o,{className:"text-right",children:"Approved Amount"})]})}),e.jsxs(V,{children:[b&&Array.from({length:6}).map((s,r)=>e.jsx(j,{children:e.jsx(l,{colSpan:4,className:"text-xs text-muted-foreground",children:"Loading…"})},r)),!b&&(u??[]).map(s=>e.jsxs(j,{children:[e.jsx(l,{children:s.provider}),e.jsx(l,{children:s.total_claims}),e.jsxs(l,{children:[(s.approval_rate*100).toFixed(1),"%"]}),e.jsx(l,{className:"text-right",children:$(s.approved_amount||0)})]},s.provider_id))]})]})})})]})}),e.jsx(_,{value:"members",children:e.jsxs(P,{children:[e.jsx(R,{children:e.jsx(T,{className:"text-base",children:"Members"})}),e.jsx(M,{children:e.jsx("div",{className:"overflow-auto",children:e.jsxs(L,{children:[e.jsx(k,{children:e.jsxs(j,{children:[e.jsx(o,{children:"Member"}),e.jsx(o,{children:"Scheme"}),e.jsx(o,{children:"Claims"}),e.jsx(o,{className:"text-right",children:"Approved Amount"})]})}),e.jsxs(V,{children:[q&&Array.from({length:6}).map((s,r)=>e.jsx(j,{children:e.jsx(l,{colSpan:4,className:"text-xs text-muted-foreground",children:"Loading…"})},r)),!q&&(te??[]).map(s=>e.jsxs(j,{children:[e.jsx(l,{children:s.member}),e.jsx(l,{children:s.scheme}),e.jsx(l,{children:s.total_claims}),e.jsx(l,{className:"text-right",children:$(s.approved_amount||0)})]},s.member_id))]})]})})})]})})]}),e.jsx(i.Suspense,{fallback:e.jsx(De,{}),children:e.jsx(Ae,{open:n,onOpenChange:d})})]}):e.jsx("div",{className:"flex items-center justify-center h-96",children:"Loading..."})}export{He as default};
