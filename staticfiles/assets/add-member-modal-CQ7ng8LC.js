import{j as e}from"./ui-vendor-BwlLg9O9.js";import{r as t}from"./react-vendor-BV8CqAlW.js";import{C as v,a as b,b as y,d as S}from"./card-B87lmAsb.js";import{I as o}from"./input-CqLO7V2k.js";import{L as i}from"./label-_J7CDay_.js";import{B as D,s as B,a as U,A as Q}from"./index-DvB6HgzU.js";import{B as W}from"./badge-BSpsjrqz.js";import{f}from"./currency-DQnJccph.js";import{S as ee}from"./skeleton-CR7iafWw.js";import{y as F,H as I,q as N,I as se,Z as ae,X as te,J as re}from"./utils-vendor-BEyFXcp4.js";function le({schemeId:n,selectedTierId:r,onTierSelect:x,className:c}){const[m,w]=t.useState([]),[_,h]=t.useState(!0),[p,g]=t.useState(null);t.useEffect(()=>{n&&(async()=>{try{h(!0),g(null);const l=await B.getSubscriptionTiers({scheme:n,is_active:!0});w(l.results||[])}catch(l){g(l.message||"Failed to load subscription tiers")}finally{h(!1)}})()},[n]);const C=s=>{switch(s){case"BASIC":return e.jsx(I,{className:"w-5 h-5 text-blue-500"});case"STANDARD":return e.jsx(F,{className:"w-5 h-5 text-green-500"});case"PREMIUM":return e.jsx(ae,{className:"w-5 h-5 text-purple-500"});case"ENTERPRISE":return e.jsx(se,{className:"w-5 h-5 text-yellow-500"});default:return e.jsx(I,{className:"w-5 h-5 text-gray-500"})}},T=s=>{switch(s){case"BASIC":return"border-blue-200 bg-blue-50";case"STANDARD":return"border-green-200 bg-green-50";case"PREMIUM":return"border-purple-200 bg-purple-50";case"ENTERPRISE":return"border-yellow-200 bg-yellow-50";default:return"border-gray-200 bg-gray-50"}};return _?e.jsxs(v,{className:c,children:[e.jsx(b,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5"}),"Choose Your Subscription Plan"]})}),e.jsx(S,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[1,2,3].map(s=>e.jsx(ee,{className:"w-full h-48"},s))})})]}):p?e.jsxs(v,{className:c,children:[e.jsx(b,{children:e.jsxs(y,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(I,{className:"w-5 h-5"}),"Subscription Plans"]})}),e.jsx(S,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:p})})]}):m.length?e.jsxs(v,{className:c,children:[e.jsxs(b,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5"}),"Choose Your Subscription Plan"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Select the plan that best fits your healthcare needs"})]}),e.jsxs(S,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:m.map(s=>e.jsxs("div",{className:`relative p-4 border-2 rounded-lg cursor-pointer transition-all hover:shadow-md ${r===s.id?"border-primary bg-primary/5 shadow-md":`border-gray-200 hover:border-primary/50 ${T(s.tier_type)}`}`,onClick:()=>x(s.id),children:[r===s.id&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("div",{className:"w-6 h-6 bg-primary rounded-full flex items-center justify-center",children:e.jsx(N,{className:"w-4 h-4 text-primary-foreground"})})}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[C(s.tier_type),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.name}),e.jsx(W,{variant:"outline",className:"text-xs",children:s.tier_type})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:f(s.monthly_price)}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"per month"}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["or ",f(s.yearly_price)," yearly"]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{children:["Up to ",s.max_dependents," dependents"]})]}),s.max_claims_per_month&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{children:[s.max_claims_per_month," claims per month"]})]}),s.max_coverage_per_year&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{children:[f(s.max_coverage_per_year)," annual coverage"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{children:[s.benefit_categories.length," benefit categories"]})]})]}),s.description&&e.jsx("div",{className:"mt-3 text-xs text-muted-foreground",children:s.description}),e.jsx(D,{className:"w-full mt-4",variant:r===s.id?"default":"outline",size:"sm",onClick:l=>{l.stopPropagation(),x(s.id)},children:r===s.id?"Selected":"Select Plan"})]},s.id))}),r&&e.jsxs("div",{className:"mt-6 p-4 bg-primary/5 border border-primary/20 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Plan Summary"}),(()=>{const s=m.find(l=>l.id===r);return s?e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Plan:"}),e.jsx("span",{className:"ml-2 font-medium",children:s.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Monthly:"}),e.jsx("span",{className:"ml-2 font-medium",children:f(s.monthly_price)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Coverage:"}),e.jsx("span",{className:"ml-2 font-medium",children:s.max_coverage_per_year?f(s.max_coverage_per_year):"Unlimited"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Dependents:"}),e.jsx("span",{className:"ml-2 font-medium",children:s.max_dependents})]})]}):null})()]})]})]}):e.jsxs(v,{className:c,children:[e.jsx(b,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5"}),"Choose Your Subscription Plan"]})}),e.jsx(S,{children:e.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"No subscription plans are currently available for this scheme."})})]})}function je({open:n,onOpenChange:r}){const[x,c]=t.useState(""),[m,w]=t.useState(""),[_,h]=t.useState(""),[p,g]=t.useState(""),[C,T]=t.useState(""),[s,l]=t.useState(""),[R,L]=t.useState(""),[d,$]=t.useState(""),[J,q]=t.useState([]),[ie,M]=t.useState([]),[A,j]=t.useState(""),[z,O]=t.useState(!1),[Y,E]=t.useState(null),[P,V]=t.useState(null),[H,G]=t.useState(!1);t.useEffect(()=>{n&&U.get("/api/schemes/categories/").then(a=>q(a.results??a)).catch(()=>q([]))},[n]),t.useEffect(()=>{if(!d){M([]),j("");return}B.getSubscriptionTiers({scheme:Number(d),is_active:!0}).then(a=>{M(a.results),a.results.length>0&&j(a.results[0].id)}).catch(()=>M([]))},[d]);async function X(a){a.preventDefault(),E(null),O(!0);try{const u=await U.post("/api/accounts/register/",{username:x,email:m,first_name:_,last_name:p,role:"PATIENT",password:C||Math.random().toString(36).slice(2,10)+"!aA1"},{noAuth:!0}),k=await U.post("/api/patients/",{user:u.id,date_of_birth:s,gender:R,scheme:d,diagnoses:"",investigations:"",treatments:""});if(A&&await B.createMemberSubscription({patient_id:k.id,tier_id:Number(A),subscription_type:"MONTHLY",start_date:new Date().toISOString().split("T")[0]}),P){const Z=new FormData;Z.append("document",P),await fetch(`${Q.replace(/\/$/,"")}/api/patients/${k.id}/documents/`,{method:"POST",body:Z,credentials:"include",headers:{...localStorage.getItem("token")?{Authorization:`Bearer ${localStorage.getItem("token")}`}:{}}})}r(!1),c(""),w(""),h(""),g(""),T(""),l(""),L(""),$(""),j(""),j("")}catch(u){E(u.message||"Failed to add member")}finally{O(!1)}}async function K(a){var u;if((u=a.target.files)!=null&&u[0]){G(!0),E(null);try{V(a.target.files[0])}catch{E("Failed to upload document")}finally{G(!1)}}}return n?e.jsx("div",{className:"fixed inset-0 z-50 grid place-items-center bg-black/40 p-4",onClick:()=>r(!1),children:e.jsxs(v,{className:"w-full max-w-lg",onClick:a=>a.stopPropagation(),children:[e.jsxs(b,{className:"flex flex-row items-center justify-between",children:[e.jsx(y,{children:"Add Member"}),e.jsx(D,{variant:"ghost",size:"icon",onClick:()=>r(!1),className:"h-6 w-6",children:e.jsx(te,{className:"h-4 w-4"})})]}),e.jsx(S,{className:"max-h-[70vh] overflow-y-auto",children:e.jsxs("form",{onSubmit:X,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"username",children:"Username"}),e.jsx(o,{id:"username",value:x,onChange:a=>c(a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"email",children:"Email"}),e.jsx(o,{id:"email",type:"email",value:m,onChange:a=>w(a.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"first",children:"First name"}),e.jsx(o,{id:"first",value:_,onChange:a=>h(a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"last",children:"Last name"}),e.jsx(o,{id:"last",value:p,onChange:a=>g(a.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"password",children:"Password (optional)"}),e.jsx(o,{id:"password",type:"password",value:C,onChange:a=>T(a.target.value),placeholder:"Auto-generated if empty"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"dob",children:"Date of Birth"}),e.jsx(o,{id:"dob",type:"date",value:s,onChange:a=>l(a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"gender",children:"Gender"}),e.jsxs("select",{id:"gender",className:"h-9 w-full rounded-md border bg-background px-3 text-sm",value:R,onChange:a=>L(a.target.value),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select…"}),e.jsx("option",{value:"M",children:"Male"}),e.jsx("option",{value:"F",children:"Female"}),e.jsx("option",{value:"O",children:"Other"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"scheme",children:"Scheme"}),e.jsxs("select",{id:"scheme",className:"h-9 w-full rounded-md border bg-background px-3 text-sm",value:d,onChange:a=>$(Number(a.target.value)),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select…"}),J.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),d&&e.jsx(le,{schemeId:Number(d),selectedTierId:A?Number(A):void 0,onTierSelect:a=>j(a)}),e.jsxs("div",{children:[e.jsx(i,{children:"Verification Document"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(o,{type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:K,disabled:H}),P&&e.jsx("span",{className:"text-xs text-success",children:P.name}),H&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Uploading…"}),e.jsx(re,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Upload ID, proof of address, or medical aid card"})]}),Y&&e.jsx("div",{className:"text-sm text-destructive",children:Y}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(D,{type:"button",variant:"ghost",onClick:()=>r(!1),children:"Cancel"}),e.jsx(D,{type:"submit",disabled:z,children:z?"Saving…":"Add Member"})]})]})})]})}):null}export{je as A};
