import{j as e}from"./ui-vendor-BwlLg9O9.js";import{C as p,a as g,b as j,c as D,d as f}from"./card-B87lmAsb.js";import{B as $}from"./badge-BSpsjrqz.js";import{u as X,B as y,a as B,g as G,b as J}from"./index-DvB6HgzU.js";import{r as d}from"./react-vendor-BV8CqAlW.js";import{A as te}from"./add-member-modal-CQ7ng8LC.js";import{SubmitClaimModal as ae}from"./submit-claim-modal-DxL7_nOZ.js";import{M as ie}from"./manage-schemes-modal-DMLno14B.js";import{P as le,k as re,l as ne,U as de,C as ce,D as oe,T as me,m as xe,n as he,o as ue}from"./utils-vendor-BEyFXcp4.js";import{S as pe}from"./separator-BoX4pgoZ.js";import{S as M}from"./skeleton-CR7iafWw.js";import{f as w}from"./currency-DQnJccph.js";import{L as ge}from"./label-_J7CDay_.js";import{R as K,B as je,C as fe,X as ye,Y as be,T as H,L as ve,a as Q,P as Ne,b as Ce,c as De}from"./chart-vendor-BhwCssww.js";import"./input-CqLO7V2k.js";function we(){const{user:r}=X(),t=(r==null?void 0:r.role)||"GUEST",[b,n]=d.useState(!1),[h,o]=d.useState(!1),[_,c]=d.useState(!1);return e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t==="ADMIN"&&e.jsxs(y,{onClick:()=>n(!0),children:[e.jsx(le,{className:"w-4 h-4 mr-2"})," Add Member"]}),(t==="ADMIN"||t==="PROVIDER")&&e.jsxs(y,{variant:"secondary",onClick:()=>o(!0),children:[e.jsx(re,{className:"w-4 h-4 mr-2"})," Submit Claim"]}),t==="ADMIN"&&e.jsxs(y,{variant:"ghost",onClick:()=>c(!0),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"})," Manage Schemes"]}),e.jsx(te,{open:b,onOpenChange:n}),e.jsx(ae,{open:h,onOpenChange:o}),e.jsx(ie,{open:_,onOpenChange:c})]})}function S({icon:r,label:t,value:b,delta:n,subtext:h,loading:o}){return e.jsxs(p,{className:"card",children:[e.jsxs(g,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(j,{className:"text-sm text-muted-foreground",children:t}),e.jsx("div",{className:"mt-1 text-2xl font-semibold",children:o?e.jsx(M,{className:"w-24 h-7"}):b})]}),e.jsx("div",{className:"p-2 rounded-md bg-muted",children:e.jsx(r,{className:"w-5 h-5 text-muted-foreground"})})]}),e.jsxs(f,{className:"pt-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[n&&e.jsx($,{variant:n.startsWith("+")?"success":"warning",children:n}),h&&e.jsx("span",{children:h})]}),e.jsx("div",{className:"h-8 mt-2 rounded-md bg-gradient-to-r from-muted to-muted/60","aria-hidden":!0})]})]})}function ze(){var P,V;const{user:r}=X(),[t,b]=d.useState(null),[n,h]=d.useState(null),[o,_]=d.useState([]),[c,L]=d.useState(!0),[Se,q]=d.useState(null),[v,T]=d.useState(""),[N,R]=d.useState(""),[k,U]=d.useState(1),[A,Y]=d.useState(1),m=5,[W,I]=d.useState(!1),[i,F]=d.useState(null),[C,z]=d.useState(!1),Z=s=>{const a=new Date;let l=new Date(a),x=new Date(a);switch(s){case"last7days":x.setDate(a.getDate()-7);break;case"last30days":x.setDate(a.getDate()-30);break;case"last90days":x.setDate(a.getDate()-90);break;case"thisYear":x=new Date(a.getFullYear(),0,1);break;case"lastYear":x=new Date(a.getFullYear()-1,0,1),l.setFullYear(a.getFullYear()-1,11,31);break;case"thisMonth":x=new Date(a.getFullYear(),a.getMonth(),1);break;case"lastMonth":x=new Date(a.getFullYear(),a.getMonth()-1,1),l=new Date(a.getFullYear(),a.getMonth(),0);break;default:return{start:"",end:""}}return{start:x.toISOString().split("T")[0],end:l.toISOString().split("T")[0]}},u=s=>{const{start:a,end:l}=Z(s);T(a),R(l),E(a,l)},ee=s=>{F(s),I(!0)},O=async s=>{if(!(!i||!i.id)){z(!0);try{await B.patch(`/api/claims/${i.id}/`,{status:s});const[a,l]=await Promise.all([G(v||void 0,N||void 0),J()]);b(a),h(l),I(!1),F(null)}catch(a){console.error("Failed to update status:",a)}finally{z(!1)}}},E=async(s,a)=>{L(!0);try{const[l,x]=await Promise.all([G(s,a),J()]);b(l),h(x)}catch(l){q(l.message||"Failed to load")}finally{L(!1)}};d.useEffect(()=>{let s=!0;const a=async()=>{try{return(await B.get("/api/alerts/")).results.slice(0,5)}catch(l){return console.error("Error fetching alerts:",l),[]}};return E(),a().then(l=>{s&&_(l)}),()=>{s=!1}},[]);const se=()=>{E(v||void 0,N||void 0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-end justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"Dashboard"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Operational overview and recent activity for Alo‑Medical."})]}),e.jsx(we,{})]}),(r==null?void 0:r.role)!=="PATIENT"&&e.jsxs(p,{children:[e.jsxs(g,{children:[e.jsx(j,{children:"Date Range Filter"}),e.jsx(D,{children:"Filter dashboard data by date range - use quick options or custom dates"})]}),e.jsxs(f,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:"Quick Select:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>u("last7days"),className:"px-3 py-1 text-xs transition-colors rounded-md bg-secondary text-secondary-foreground hover:bg-secondary/80",children:"Last 7 Days"}),e.jsx("button",{onClick:()=>u("last30days"),className:"px-3 py-1 text-xs transition-colors rounded-md bg-secondary text-secondary-foreground hover:bg-secondary/80",children:"Last 30 Days"}),e.jsx("button",{onClick:()=>u("last90days"),className:"px-3 py-1 text-xs transition-colors rounded-md bg-secondary text-secondary-foreground hover:bg-secondary/80",children:"Last 90 Days"}),e.jsx("button",{onClick:()=>u("thisMonth"),className:"px-3 py-1 text-xs transition-colors rounded-md bg-secondary text-secondary-foreground hover:bg-secondary/80",children:"This Month"}),e.jsx("button",{onClick:()=>u("lastMonth"),className:"px-3 py-1 text-xs transition-colors rounded-md bg-secondary text-secondary-foreground hover:bg-secondary/80",children:"Last Month"}),e.jsx("button",{onClick:()=>u("thisYear"),className:"px-3 py-1 text-xs transition-colors rounded-md bg-secondary text-secondary-foreground hover:bg-secondary/80",children:"This Year"}),e.jsx("button",{onClick:()=>u("lastYear"),className:"px-3 py-1 text-xs transition-colors rounded-md bg-secondary text-secondary-foreground hover:bg-secondary/80",children:"Last Year"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"start-date",className:"text-sm font-medium",children:"Start Date:"}),e.jsx("input",{id:"start-date",type:"date",value:v,onChange:s=>T(s.target.value),className:"px-3 py-2 text-sm border rounded-md border-input"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"end-date",className:"text-sm font-medium",children:"End Date:"}),e.jsx("input",{id:"end-date",type:"date",value:N,onChange:s=>R(s.target.value),className:"px-3 py-2 text-sm border rounded-md border-input"})]}),e.jsx("button",{onClick:se,className:"px-4 py-2 text-sm font-medium rounded-md bg-primary text-primary-foreground hover:bg-primary/90",children:"Apply Filter"}),e.jsx("button",{onClick:()=>{T(""),R(""),E()},className:"px-4 py-2 text-sm font-medium rounded-md bg-secondary text-secondary-foreground hover:bg-secondary/90",children:"Clear"})]})]})]}),(r==null?void 0:r.role)!=="PATIENT"&&e.jsxs("section",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-3",children:[e.jsx(S,{icon:de,label:"Active Members",value:(t==null?void 0:t.kpis.active_members)??"",delta:"",subtext:"total registered",loading:c}),e.jsx(S,{icon:ce,label:"Total Claims",value:(t==null?void 0:t.kpis.total_claims_period)??"",delta:"",subtext:(t==null?void 0:t.kpis.data_period)==="all_time"?"all time":(t==null?void 0:t.kpis.data_period)==="custom"?`${v||"start"} to ${N||"end"}`:"last 30 days",loading:c}),e.jsx(S,{icon:oe,label:"Claim Value (Approved)",value:w((t==null?void 0:t.kpis.claim_value_approved)??0),delta:"",subtext:(t==null?void 0:t.kpis.data_period)==="all_time"?"all time":(t==null?void 0:t.kpis.data_period)==="custom"?`${v||"start"} to ${N||"end"}`:"last 30 days",loading:c}),e.jsx(S,{icon:me,label:"Pending Claim Value",value:w((t==null?void 0:t.kpis.pending_claim_value)??0),delta:"",subtext:(t==null?void 0:t.kpis.data_period)==="all_time"?"all time":(t==null?void 0:t.kpis.data_period)==="custom"?`${v||"start"} to ${N||"end"}`:"last 30 days",loading:c}),e.jsx(S,{icon:xe,label:"Utilization Rate",value:`${Math.round(((t==null?void 0:t.kpis.utilization_rate)??0)*100)}%`,delta:"",subtext:"of processed claims",loading:c}),e.jsx(S,{icon:he,label:"Avg. Processing Time",value:`${((V=(P=t==null?void 0:t.kpis.avg_processing_days)==null?void 0:P.toFixed)==null?void 0:V.call(P,2))??"0.00"} days`,delta:"",subtext:"goal ≤ 3 days",loading:c})]}),e.jsxs("section",{className:"grid grid-cols-1 gap-4 lg:grid-cols-3",children:[e.jsxs(p,{className:"lg:col-span-2",children:[e.jsxs(g,{children:[e.jsx(j,{children:"Scheme Utilization Analytics"}),e.jsx(D,{children:"Claim values by medical aid scheme"})]}),e.jsx(f,{children:c?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(M,{className:"w-full h-48"})}):e.jsx(K,{width:"100%",height:250,children:e.jsxs(je,{data:(t==null?void 0:t.scheme_utilization)||[],children:[e.jsx(fe,{strokeDasharray:"3 3"}),e.jsx(ye,{dataKey:"patient__scheme__name",tick:{fontSize:12},angle:-45,textAnchor:"end",height:60}),e.jsx(be,{tick:{fontSize:12}}),e.jsx(H,{formatter:(s,a)=>[a==="total_amount"?w(s):s,a==="total_amount"?"Total Amount":"Total Claims"]}),e.jsx(ve,{}),e.jsx(Q,{dataKey:"total_amount",fill:"#3b82f6",name:"Total Amount",radius:[4,4,0,0]}),e.jsx(Q,{dataKey:"total_claims",fill:"#10b981",name:"Total Claims",radius:[4,4,0,0]})]})})}),!c&&(t==null?void 0:t.scheme_utilization)&&t.scheme_utilization.length>0&&e.jsx("div",{className:"px-4 pb-4",children:e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Top ",t.scheme_utilization.length," schemes by claim volume"]})})]}),e.jsxs(p,{children:[e.jsxs(g,{children:[e.jsx(j,{children:"Claims Status Snapshot"}),e.jsx(D,{children:"Approved, Pending, Rejected"})]}),e.jsx(f,{children:c?e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsx(M,{className:"w-32 h-32 rounded-full"})}):e.jsx(K,{width:"100%",height:220,children:e.jsxs(Ne,{children:[e.jsx(Ce,{data:Object.entries((t==null?void 0:t.status_snapshot)||{}).map(([s,a])=>({name:s,value:a.count,amount:a.amount})),cx:"50%",cy:"50%",innerRadius:40,outerRadius:80,paddingAngle:5,dataKey:"value",children:Object.entries((t==null?void 0:t.status_snapshot)||{}).map(([s],a)=>e.jsx(De,{fill:s==="APPROVED"?"#22c55e":s==="PENDING"?"#f59e0b":s==="REJECTED"?"#ef4444":"#6b7280"},`cell-${a}`))}),e.jsx(H,{formatter:(s,a,l)=>[`${s} claims (${w(l.payload.amount||0)})`,a]})]})})}),e.jsx("div",{className:"px-4 pb-4",children:e.jsx("div",{className:"grid grid-cols-2 gap-2 text-xs text-muted-foreground",children:Object.entries((t==null?void 0:t.status_snapshot)||{}).map(([s,a])=>e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"flex-shrink-0 w-2 h-2 rounded-full",style:{backgroundColor:s==="APPROVED"?"#22c55e":s==="PENDING"?"#f59e0b":s==="REJECTED"?"#ef4444":"#6b7280"}}),e.jsxs("span",{className:"truncate text-[10px] leading-tight",children:[s.replace("_"," ")," (",a.count,")"]})]},s))})})]})]}),e.jsxs("section",{className:"grid grid-cols-1 gap-4 lg:grid-cols-3",children:[e.jsxs(p,{className:"lg:col-span-2",children:[e.jsxs(g,{children:[e.jsx(j,{children:"Recent Activity"}),e.jsx(D,{children:"Provider submissions, registrations, approvals"})]}),e.jsx(f,{children:!n&&c?e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((s,a)=>e.jsx("div",{className:"py-3",children:e.jsx(M,{className:"w-3/4 h-4"})},a))}):e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"text-sm divide-y divide-border",children:n==null?void 0:n.results.slice((k-1)*m,k*m).map(s=>e.jsxs("li",{className:"flex items-center justify-between py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ue,{className:"w-4 h-4 text-success"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.title}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.provider," • Member: ",s.member," • ",w(s.amount)]})]})]}),e.jsx("button",{className:"text-xs underline text-accent hover:text-accent/80",onClick:()=>ee(s),children:"View"})]},`${s.type}-${s.id}-${s.timestamp}`))}),n&&n.results.length>m&&e.jsxs("div",{className:"flex items-center justify-between pt-4 mt-4 border-t",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Showing ",Math.min(k*m,n.results.length)," of ",n.results.length," activities"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>U(s=>Math.max(1,s-1)),disabled:k===1,className:"px-3 py-1 text-xs rounded bg-secondary text-secondary-foreground disabled:opacity-50",children:"Previous"}),e.jsx("button",{onClick:()=>U(s=>Math.min(Math.ceil(n.results.length/m),s+1)),disabled:k===Math.ceil(n.results.length/m),className:"px-3 py-1 text-xs rounded bg-secondary text-secondary-foreground disabled:opacity-50",children:"Next"})]})]})]})})]}),e.jsxs(p,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(j,{children:"Real‑Time Alerts"}),e.jsx(D,{children:"Live operational signals"})]}),e.jsx($,{variant:"warning",children:o.length})]}),e.jsxs(f,{children:[e.jsx("div",{className:"sticky top-0 z-10 px-4 py-2 mb-2 -mx-4 -mt-4 text-xs bg-card text-muted-foreground",children:"Newest first"}),c?e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((s,a)=>e.jsx(M,{className:"w-full h-16"},a))}):o.length===0?e.jsx("div",{className:"py-4 text-center text-muted-foreground",children:"No alerts to display"}):e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"space-y-3 text-sm",children:o.slice((A-1)*m,A*m).map(s=>e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("span",{className:`mt-1 h-2.5 w-2.5 rounded-full ${s.severity==="HIGH"?"bg-destructive":s.severity==="MEDIUM"?"bg-warning":"bg-info"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.message}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.patient_id&&`Patient ID: ${s.patient_id} • `,new Date(s.created_at).toLocaleString()]}),e.jsxs("div",{className:"flex gap-2 mt-2 text-xs",children:[e.jsx("button",{className:"text-accent",children:"View Details"}),!s.is_read&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:"•"}),e.jsx("button",{className:"text-accent",children:"Mark Read"})]})]})]})]},s.id))}),o.length>m&&e.jsxs("div",{className:"flex items-center justify-between pt-4 mt-4 border-t",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Showing ",Math.min(A*m,o.length)," of ",o.length," alerts"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Y(s=>Math.max(1,s-1)),disabled:A===1,className:"px-3 py-1 text-xs rounded bg-secondary text-secondary-foreground disabled:opacity-50",children:"Previous"}),e.jsx("button",{onClick:()=>Y(s=>Math.min(Math.ceil(o.length/m),s+1)),disabled:A===Math.ceil(o.length/m),className:"px-3 py-1 text-xs rounded bg-secondary text-secondary-foreground disabled:opacity-50",children:"Next"})]})]})]})]})]})]}),e.jsx(pe,{}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Click KPI cards or chart segments to drill into filtered views."}),W&&i&&e.jsx("div",{className:"fixed inset-0 z-50 grid p-4 place-items-center bg-black/40",children:e.jsxs(p,{className:"w-full max-w-md",children:[e.jsxs(g,{children:[e.jsx(j,{children:"Activity Details"}),e.jsx(D,{children:i.type==="CLAIM_SUBMITTED"?"Claim Submission":"Claim Approval"})]}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Type:"})," ",i.title]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Member:"})," ",i.member]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Provider:"})," ",i.provider]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Amount:"})," ",w(i.amount)]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Date:"})," ",new Date(i.timestamp).toLocaleString()]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Current Status:"}),e.jsx($,{variant:i.status==="APPROVED"?"default":i.status==="PENDING"?"info":i.status==="REJECTED"?"destructive":"outline",className:"ml-2",children:i.status})]})]}),((r==null?void 0:r.role)==="ADMIN"||(r==null?void 0:r.role)==="PROVIDER")&&i.type==="CLAIM_SUBMITTED"&&e.jsxs("div",{className:"pt-4 space-y-3 border-t",children:[e.jsx(ge,{className:"text-sm font-medium",children:"Update Status"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{size:"sm",variant:i.status==="APPROVED"?"default":"outline",onClick:()=>O("APPROVED"),disabled:C||i.status==="APPROVED",children:C?"Updating...":"Approve"}),e.jsx(y,{size:"sm",variant:i.status==="PENDING"?"default":"outline",onClick:()=>O("PENDING"),disabled:C||i.status==="PENDING",children:C?"Updating...":"Pending"}),e.jsx(y,{size:"sm",variant:i.status==="REJECTED"?"default":"outline",onClick:()=>O("REJECTED"),disabled:C||i.status==="REJECTED",children:C?"Updating...":"Reject"})]})]}),e.jsx("div",{className:"flex justify-end gap-2 pt-4 border-t",children:e.jsx(y,{variant:"ghost",onClick:()=>{I(!1),F(null)},children:"Close"})})]})]})})]})}export{ze as default};
