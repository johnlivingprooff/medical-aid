import{j as s}from"./ui-vendor-BwlLg9O9.js";import{r as t}from"./react-vendor-BV8CqAlW.js";import{C as L,a as R,b as _,d as q}from"./card-B87lmAsb.js";import{I as z}from"./input-CqLO7V2k.js";import{L as p}from"./label-_J7CDay_.js";import{a as d,B as u}from"./index-DvB6HgzU.js";import{f as A}from"./currency-DQnJccph.js";import{X as I}from"./utils-vendor-BEyFXcp4.js";function J({open:i,onOpenChange:n}){const[l,f]=t.useState(""),[a,m]=t.useState(""),[r,h]=t.useState(""),[k,x]=t.useState([]),[T,v]=t.useState(!1),[b,j]=t.useState(null),[E,y]=t.useState(null),[P,g]=t.useState(null),[C,N]=t.useState(!1),[S,o]=t.useState(null),[F,w]=t.useState([]);t.useEffect(()=>{i&&d.get("/api/patients/").then(e=>x(e.results??e)).catch(()=>x([]))},[i]),t.useEffect(()=>{i&&d.get("/api/schemes/benefit-types/").then(e=>{const c=e.results??e;w(c),!a&&c.length&&m(c[0].id)}).catch(()=>w([]))},[i]);async function M(){v(!0),o(null);try{const e=await d.post("/api/claims/validate/",{patient:l,service_type:a,cost:Number(r)});j(e.approved),y(e.payable),g(e.reason)}catch(e){o(e.message||"Validation failed")}finally{v(!1)}}async function B(e){e.preventDefault(),N(!0),o(null);try{await d.post("/api/claims/",{patient:l,service_type:a,cost:Number(r)}),n(!1),f(""),m(""),h(""),j(null),y(null),g(null)}catch(c){o(c.message||"Failed to submit claim")}finally{N(!1)}}return i?s.jsx("div",{className:"fixed inset-0 z-50 grid place-items-center bg-black/40 p-4",onClick:()=>n(!1),children:s.jsxs(L,{className:"w-full max-w-xl",onClick:e=>e.stopPropagation(),children:[s.jsxs(R,{className:"flex flex-row items-center justify-between",children:[s.jsx(_,{children:"Submit Claim"}),s.jsx(u,{variant:"ghost",size:"icon",onClick:()=>n(!1),className:"h-6 w-6",children:s.jsx(I,{className:"h-4 w-4"})})]}),s.jsx(q,{className:"max-h-[70vh] overflow-y-auto",children:s.jsxs("form",{onSubmit:B,className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(p,{htmlFor:"patient",children:"Member"}),s.jsxs("select",{id:"patient",className:"h-9 w-full rounded-md border bg-background px-3 text-sm",value:l,onChange:e=>f(Number(e.target.value)),required:!0,children:[s.jsx("option",{value:"",disabled:!0,children:"Select…"}),k.map(e=>s.jsx("option",{value:e.id,children:e.user_username},e.id))]})]}),s.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(p,{htmlFor:"serviceType",children:"Service Type"}),s.jsx("select",{id:"serviceType",className:"h-9 w-full rounded-md border bg-background px-3 text-sm",value:a,onChange:e=>m(Number(e.target.value)),children:F.filter(e=>e.name.toLowerCase()!=="add new").map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(p,{htmlFor:"cost",children:"Cost (MWK)"}),s.jsx(z,{id:"cost",inputMode:"decimal",value:r,onChange:e=>h(e.target.value),placeholder:"25000",required:!0})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(u,{type:"button",variant:"secondary",onClick:M,disabled:T||!l||!r||!a,children:"Check Coverage"}),b!==null&&s.jsx("span",{className:"text-sm",children:b?`Approved • Payable ${A(E||0)}`:`Rejected • ${P}`})]}),S&&s.jsx("div",{className:"text-sm text-destructive",children:S}),s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx(u,{type:"button",variant:"ghost",onClick:()=>n(!1),children:"Cancel"}),s.jsx(u,{type:"submit",disabled:C||!l||!r||!a,children:C?"Submitting…":"Submit Claim"})]})]})})]})}):null}export{J as SubmitClaimModal};
